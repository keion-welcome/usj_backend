# ハイブリッド型ユーザーID設計 開発チェックリスト

## 📋 開発前の準備

### ✅ 環境確認
- [ ] 開発環境のセットアップ確認
- [ ] テストデータの準備
- [ ] 開発用ブランチの作成
- [ ] チームメンバーへの開発計画共有

### ✅ 影響範囲の確認
- [ ] 現在のJWT認証フローの確認
- [ ] 変更が必要なファイルの洗い出し
- [ ] フロントエンド側の変更箇所確認
- [ ] テストケースの更新計画

## 🔧 Phase 1: エンティティ変更（Spring Boot自動スキーマ生成）

### ✅ UserEntity変更
- [ ] `userId`フィールド追加（UUID型）
- [ ] `@PrePersist`メソッド追加（UUID自動生成）
- [ ] バリデーション制約追加
- [ ] コンストラクタ更新

### ✅ 設定確認
- [ ] `application-dev.yml`で`spring.jpa.hibernate.ddl-auto: create`確認
- [ ] `data.sql`のテストデータ更新（UUID対応）
- [ ] アプリケーション起動時のスキーマ生成確認

### ✅ データ検証
- [ ] アプリケーション起動後のテーブル構造確認
- [ ] テストデータの正常な挿入確認
- [ ] UUIDの自動生成確認

## 🔧 Phase 2: エンティティ・ドメインモデル変更

### ✅ UserEntity変更
- [ ] `userId`フィールド追加
- [ ] `@PrePersist`メソッド追加（UUID自動生成）
- [ ] バリデーション制約追加
- [ ] コンストラクタ更新

### ✅ ドメインモデル変更
- [ ] `User`クラスに`userId`フィールド追加
- [ ] マッパー更新（Entity ↔ Domain）
- [ ] テストケース更新

### ✅ リポジトリ変更
- [ ] `JpaUserRepository`に`findByUserId`メソッド追加
- [ ] `UserRepositoryImpl`更新
- [ ] `SecurityUserRepository`更新

## 🔧 Phase 3: JWT認証変更

### ✅ JwtUtil変更
- [ ] `generateToken`メソッドの引数を`userId`に変更
- [ ] `validateToken`メソッド更新
- [ ] コメント更新
- [ ] テストケース更新

### ✅ UserDetailsService変更
- [ ] `loadUserByUsername`メソッド更新
- [ ] `SecurityUserRepository`の使用箇所確認
- [ ] エラーハンドリング更新

### ✅ JwtAuthFilter変更
- [ ] 認証フローの確認
- [ ] エラーハンドリング確認

## 🔧 Phase 4: ユースケース変更

### ✅ RegisterUseCase変更
- [ ] JWT生成時に`userId`を使用
- [ ] レスポンスに`userId`を含める
- [ ] テストケース更新

### ✅ LoginUseCase変更
- [ ] JWT生成時に`userId`を使用
- [ ] レスポンスに`userId`を含める
- [ ] テストケース更新

### ✅ その他のユースケース
- [ ] ユーザー検索ロジックの確認
- [ ] 認証が必要な処理の確認

## 🔧 Phase 5: APIレスポンス変更

### ✅ DTO変更
- [ ] `AuthResponse`に`userId`フィールド追加
- [ ] `UserResponse`更新（内部IDを除外）
- [ ] `ProfileResponse`更新
- [ ] その他のレスポンスDTO確認

### ✅ マッパー変更
- [ ] `UserMapper`更新
- [ ] `ProfileMapper`更新
- [ ] レスポンス生成ロジック確認

### ✅ コントローラー変更
- [ ] レスポンス生成箇所の確認
- [ ] エラーレスポンスの確認

## 🔧 Phase 6: テスト更新

### ✅ 単体テスト
- [ ] `UserEntity`テスト更新
- [ ] `JwtUtil`テスト更新
- [ ] `UserDetailsService`テスト更新
- [ ] ユースケーステスト更新
- [ ] マッパーテスト更新

### ✅ 統合テスト
- [ ] 認証フローテスト更新
- [ ] APIエンドポイントテスト更新
- [ ] データベース操作テスト更新

### ✅ セキュリティテスト
- [ ] JWTトークン検証テスト
- [ ] 認証失敗ケーステスト
- [ ] 権限チェックテスト

## 🔧 Phase 7: フロントエンド対応

### ✅ API呼び出し更新
- [ ] 認証APIのレスポンス処理更新
- [ ] ユーザー情報取得API更新
- [ ] プロフィール取得API更新

### ✅ トークン管理
- [ ] JWTトークンの保存方法確認
- [ ] トークン更新ロジック確認
- [ ] ログアウト処理確認

### ✅ エラーハンドリング
- [ ] 認証エラー処理確認
- [ ] ネットワークエラー処理確認

## 🔧 Phase 8: 開発環境での検証

### ✅ 機能テスト
- [ ] ユーザー登録機能のテスト
- [ ] ログイン機能のテスト
- [ ] プロフィール取得機能のテスト
- [ ] JWT認証のテスト

### ✅ 統合テスト
- [ ] 全APIエンドポイントのテスト
- [ ] データベース操作のテスト
- [ ] エラーハンドリングのテスト

### ✅ パフォーマンス確認
- [ ] レスポンス時間の確認
- [ ] データベースクエリの確認
- [ ] メモリ使用量の確認

## 🔧 Phase 9: 最終確認

### ✅ 動作確認
- [ ] 全機能の正常動作確認
- [ ] エラーケースの確認
- [ ] セキュリティ要件の確認

### ✅ コードレビュー
- [ ] 実装コードのレビュー
- [ ] テストコードのレビュー
- [ ] ドキュメントの確認

### ✅ 開発完了
- [ ] 全テストの通過確認
- [ ] コードの品質確認
- [ ] ドキュメントの完成確認

## 📊 開発完了チェックリスト

### ✅ 技術的完了
- [ ] 全テストが通る
- [ ] 機能要件を満たす
- [ ] セキュリティ要件を満たす
- [ ] エラーハンドリングが適切

### ✅ ドキュメント完了
- [ ] API仕様書更新
- [ ] 開発者向けドキュメント更新
- [ ] 実装ガイド作成
- [ ] テストガイド作成

### ✅ 開発環境準備完了
- [ ] 開発環境での動作確認
- [ ] テストデータの準備
- [ ] 開発用設定の確認
- [ ] チーム開発環境の整備

## 🚨 注意事項

### 重要なチェックポイント
1. **データ整合性**: 開発環境でのデータ整合性を確認
2. **セキュリティ**: 個人情報の露出がないことを確認
3. **機能性**: 全機能が正常に動作することを確認
4. **テスト**: 十分なテストカバレッジを確保

### 開発時の注意点
- [ ] 開発ブランチでの作業
- [ ] 定期的なコミット・プッシュ
- [ ] コードレビューの実施
- [ ] テストの自動実行

## 📞 開発チーム連絡先

- **技術責任者**: [連絡先]
- **プロジェクトマネージャー**: [連絡先]
- **開発リーダー**: [連絡先]
- **QA担当者**: [連絡先]

---

**開発完了予定日**: [YYYY-MM-DD]
**開発責任者**: [名前]
**承認者**: [名前] 